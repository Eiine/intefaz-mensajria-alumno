{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel General</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body class="bg-light" style="padding-top: 70px;">
 {% include "mensajes/navbar.html" %}
<div class="container mt-5">
    <h2 class="text-center mb-4">üìö Panel General de Informaci√≥n</h2>

    <!-- Nav tabs -->
    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item"><button class="nav-link active" id="carreras-tab" data-bs-toggle="tab" data-bs-target="#carreras" type="button" role="tab">Carreras</button></li>
        <li class="nav-item"><button class="nav-link" id="alumnos-tab" data-bs-toggle="tab" data-bs-target="#alumnos" type="button" role="tab">Alumnos</button></li>
        <li class="nav-item"><button class="nav-link" id="tipos-tab" data-bs-toggle="tab" data-bs-target="#tipos" type="button" role="tab">Tipos de Notificaci√≥n</button></li>
        <li class="nav-item"><button class="nav-link" id="notificaciones-tab" data-bs-toggle="tab" data-bs-target="#notificaciones" type="button" role="tab">Notificaciones</button></li>
        <li class="nav-item"><button class="nav-link" id="pagos-tab" data-bs-toggle="tab" data-bs-target="#pagos" type="button" role="tab">Pagos</button></li>
        <li class="nav-item"><button class="nav-link" id="mensajes-tab" data-bs-toggle="tab" data-bs-target="#mensajes" type="button" role="tab">Mensajes Internos</button></li>
        <li class="nav-item"><button class="nav-link" id="preferencias-tab" data-bs-toggle="tab" data-bs-target="#preferencias" type="button" role="tab">Preferencias</button></li>
    </ul>

    <!-- Tab panes -->
    <div class="tab-content border border-top-0 p-4 bg-white">
        <!-- Carreras -->
        <div class="tab-pane fade show active" id="carreras" role="tabpanel">
            <h4>Carreras registradas</h4>
            <table class="table table-striped">
                <thead><tr><th>Nombre</th><th>Modalidad</th><th>Descripci√≥n</th></tr></thead>
                <tbody>
                    {% for c in carreras %}
                        <tr><td>{{ c.nombre }}</td><td>{{ c.modalidad }}</td><td>{{ c.descripcion }}</td></tr>
                    {% empty %}
                        <tr><td colspan="3" class="text-center">No hay carreras registradas.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Alumnos -->
        <div class="tab-pane fade" id="alumnos" role="tabpanel">
            <h4>Lista de alumnos</h4>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>ID Usuario</th>
                        <th>Nombre</th>
                        <th>DNI</th>
                        <th>Tel√©fono</th>
                        <th>Direcci√≥n</th>
                        <th>Carrera</th>
                        <th>Doc.</th>
                        <th>Pago</th>
                        <th>Admin</th>
                    </tr>
                </thead>
                <tbody>
                    {% for a in alumnos %}
                        <tr>
                            <td>{{ a.user.id }}</td>
                            <td>{{ a.user.first_name }} {{ a.user.last_name }}</td>
                            <td>{{ a.dni }}</td>
                            <td>{{ a.telefono }}</td>
                            <td>{{ a.direccion }}</td>
                            <td>{{ a.carrera }}</td>
                            <td>{% if a.estado_documentacion %}‚úÖ{% else %}‚ùå{% endif %}</td>
                            <td>{% if a.estado_pago %}‚úÖ{% else %}‚ùå{% endif %}</td>
                            <td>{% if a.user.is_staff %}üõ°Ô∏è S√≠{% else %}üë§ No{% endif %}</td>
                        </tr>
                    {% empty %}
                        <tr><td colspan="9" class="text-center">No hay alumnos registrados.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Tipos de Notificaci√≥n -->
        <div class="tab-pane fade" id="tipos" role="tabpanel">
            <h4>Tipos de notificaci√≥n</h4>
            <table class="table table-striped">
                <thead><tr><th>Nombre</th><th>Canal</th><th>Fecha</th><th>Carrera</th></tr></thead>
                <tbody>
                    {% for t in tipos_notificacion %}
                        <tr><td>{{ t.nombre_tipo }}</td><td>{{ t.canal }}</td><td>{{ t.fecha }}</td><td>{{ t.carrera }}</td></tr>
                    {% empty %}
                        <tr><td colspan="4" class="text-center">No hay tipos de notificaci√≥n.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Notificaciones -->
        <div class="tab-pane fade" id="notificaciones" role="tabpanel">
            <h4>Notificaciones enviadas</h4>
            <table class="table table-striped">
                <thead><tr><th>Tipo</th><th>Fecha de env√≠o</th><th>Estado</th><th>Mensaje</th><th>Alumnos</th></tr></thead>
                <tbody>
                    {% for n in notificaciones %}
                        <tr>
                            <td>{{ n.tipo }}</td>
                            <td>{{ n.fecha_envio }}</td>
                            <td>{{ n.estado_envio }}</td>
                            <td>{{ n.mensaje|truncatechars:50 }}</td>
                            <td>
                                {% for a in n.alumnos.all %}
                                    <span class="badge bg-secondary">{{ a }}</span>
                                {% empty %}
                                    <em>Sin destinatarios</em>
                                {% endfor %}
                            </td>
                        </tr>
                    {% empty %}
                        <tr><td colspan="5" class="text-center">No hay notificaciones registradas.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Pagos -->
        <div class="tab-pane fade" id="pagos" role="tabpanel">
            <h4>Pagos registrados</h4>
            <table class="table table-striped">
                <thead><tr><th>Alumno</th><th>Fecha</th><th>Monto</th><th>Estado</th><th>Descripci√≥n</th></tr></thead>
                <tbody>
                    {% for p in pagos %}
                        <tr><td>{{ p.alumno }}</td><td>{{ p.fecha_pago }}</td><td>${{ p.monto }}</td><td>{{ p.estado_pago }}</td><td>{{ p.descripcion }}</td></tr>
                    {% empty %}
                        <tr><td colspan="5" class="text-center">No hay pagos registrados.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Mensajes internos -->
        <div class="tab-pane fade" id="mensajes" role="tabpanel">
            <h4>Mensajes internos</h4>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Remitente</th>
                        <th>Destinatario</th>
                        <th>Mensaje</th>
                        <th>Fecha</th>
                        <th>Le√≠do</th>
                    </tr>
                </thead>
                <tbody>
                    {% for m in mensajes %}
                        <tr>
                            <td>{{ m.remitente }}</td>
                            <td>{{ m.destinatario }}</td>
                            <td>{{ m.mensaje|truncatechars:40 }}</td>
                            <td>{{ m.fecha_envio }}</td>
                            <td>{% if m.leido %}‚úÖ{% else %}üì≠{% endif %}</td>
                        </tr>
                    {% empty %}
                        <tr><td colspan="5" class="text-center">No hay mensajes internos.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Preferencias -->
        <div class="tab-pane fade" id="preferencias" role="tabpanel">
            <h4>Preferencias de notificaci√≥n</h4>
            <table class="table table-striped">
                <thead><tr><th>Alumno</th><th>Tipo</th><th>Motivo</th><th>Correo</th><th>App</th><th>Agrupadas</th><th>Prioridad</th><th>Fecha</th></tr></thead>
                <tbody>
                    {% for pr in preferencias %}
                        <tr>
                            <td>{{ pr.alumno }}</td>
                            <td>{{ pr.tipo }}</td>
                            <td>{{ pr.motivo }}</td>
                            <td>{% if pr.correo_electronico %}‚úÖ{% else %}‚ùå{% endif %}</td>
                            <td>{% if pr.aplicacion_movil %}‚úÖ{% else %}‚ùå{% endif %}</td>
                            <td>{% if pr.habilitar_agrupadas %}‚úÖ{% else %}‚ùå{% endif %}</td>
                            <td>{{ pr.prioridad_notificaciones }}</td>
                            <td>{{ pr.fecha_actualizacion }}</td>
                        </tr>
                    {% empty %}
                        <tr><td colspan="8" class="text-center">No hay preferencias configuradas.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
